var g=(a,n,i)=>new Promise((u,r)=>{var p=o=>{try{c(i.next(o))}catch(d){r(d)}},b=o=>{try{c(i.throw(o))}catch(d){r(d)}},c=o=>o.done?u(o.value):Promise.resolve(o.value).then(p,b);c((i=i.apply(a,n)).next())});import{t as x,n as v,x as k,b as f,at as w,a8 as y,aA as m,aL as A,aU as S,r as z,aV as j,af as B,aW as O}from"./index-D3FY82Rz.js";import{g as Y,d as $,B as N}from"./monitor-Ml_QDAkh.js";import{_ as V}from"./description.vue_vue_type_style_index_0_lang-DZHckEZL.js";import{u as F}from"./useBasicLayout-DS6NlR9d.js";function H(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!j(a)}const{isMobile:T}=F();function J(a){const n=x({uid:"",status:"",operation:"",module:"",currentPage:1,pageSize:10}),i=v([]),u=v(!0),r=v(0),p=x({total:0,pageSize:10,currentPage:1,pageSizes:[10,20,50,100],background:!0}),c=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:e=>(n.currentPage-1)*n.pageSize+e+1,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"业务模块",prop:"module",minWidth:160,cellRenderer:({row:e})=>f("span",{style:{color:"blue"}},[e.module])},{label:"用户",prop:"uid",minWidth:100},{label:"操作类型",prop:"operation",minWidth:100,cellRenderer:({row:e,props:t})=>{const l=[{value:0,text:"其他"},{value:1,text:"修改"},{value:2,text:"添加"},{value:3,text:"删除"},{value:4,text:"登录"},{value:5,text:"上传"}],M=[{value:0,text:""},{value:1,text:null},{value:2,text:"warning"},{value:3,text:"danger"},{value:4,text:"success"},{value:5,text:"info"}],h=l[e.operation].text,_=M[e.operation].text;return f(z("el-tag"),{size:t.size,type:_,effect:"dark"},H(h)?h:{default:()=>[h]})}},{label:"请求方式",prop:"method",minWidth:100,cellRenderer:({row:e})=>{let t="",l="";return l=e.request_params.method,l=="GET"?t="green":l=="POST"?t="#e6a23c":l=="PUT"?t="blue":t="red",f("span",{style:{color:t}},[l])}},{label:"IP地址",prop:"ip",minWidth:100},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:e,props:t})=>f(z("el-tag"),{size:t.size,type:e.status===0?"danger":"success",effect:"dark"},{default:()=>[e.status===0?"失败":"成功"]})},{label:"访问时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>w(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function o(e){$(e.id).then(t=>g(this,null,function*(){t.code===200?(m(`您删除了日志ID为${e.id}的这条数据`,{type:"success"}),yield s()):m(`操作失败，${t.message}`,{type:"error"})}))}function d(e){r.value=e.length,a.value.setAdaptive()}function D(){r.value=0,a.value.getTableRef().clearSelection()}function W(){const e=a.value.getTableRef().getSelectionRows();N(S(e,"id")).then(t=>g(this,null,function*(){t.code===200?(m(`已删除日志编号为 ${S(e,"id")} 的数据`,{type:"success"}),yield s()):m(`操作失败，${t.message}`,{type:"error"}),a.value.getTableRef().clearSelection()}))}function C(e){n.currentPage=1,n.pageSize=e,s()}function P(e){n.currentPage=e,s()}function R(e){A({title:"日志详情",width:"60%",draggable:!0,fullscreen:!!T.value,closeOnClickModal:!0,contentRenderer:()=>B(V,y(e)),footerButtons:[{label:"关闭",text:!0,size:"large",bg:!0,btnClick:({dialog:{options:t,index:l}})=>{O(t,l)}}]})}function s(){return g(this,null,function*(){u.value=!0;const{data:e}=yield Y(y(n));i.value=e.results,p.total=e.total,setTimeout(()=>{u.value=!1},500)})}const L=e=>{e&&(e.resetFields(),s())};return k(()=>{s()}),{form:n,loading:u,columns:c,dataList:i,selectedNum:r,pagination:p,isMobile:T,onbatchDel:W,openDialog:R,onSearch:s,resetForm:L,handleDelete:o,onSelectionCancel:D,handleSizeChange:C,handleCurrentChange:P,handleSelectionChange:d}}export{J as useRole};
