var s=(a,h,i)=>new Promise((o,$)=>{var S=u=>{try{b(i.next(u))}catch(y){$(y)}},c=u=>{try{b(i.throw(u))}catch(y){$(y)}},b=u=>u.done?o(u.value):Promise.resolve(u.value).then(S,c);b((i=i.apply(a,h)).next())});import{aN as m,t as G,n as v,q as J,x as Q,at as X,a8 as Z,aA as l,aL as N,aO as w,b as f,b6 as ee,b7 as te,f as k,r as O,aV as ae,af as V}from"./index-D3FY82Rz.js";import{e as j}from"./form-ZMl9SkDR.js";import{u as ne}from"./useBasicLayout-DS6NlR9d.js";import"./index-CsrB2J66.js";const B=a=>m.request("post","/api/file/folds/list",{data:a}),se=a=>m.request("post","/api/file/folds/last/list",{data:a}),le=a=>m.request("post","/api/file/folds/read",{data:a}),ie=a=>m.request("post","/api/file/folds/add/file",{data:a}),oe=a=>m.request("post","/api/file/folds/add/fold",{data:a}),T=a=>m.request("post","/api/file/folds/del",{data:a}),ue=a=>m.request("put","/api/file/folds/edit",{data:a}),{isMobile:q}=ne();function ce(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!ae(a)}const{clipboardValue:re,copied:pe}=w(),de=a=>{re.value=a,pe.value&&l("复制成功",{type:"success"})};function ve(){const a=G({currentPage:1,pageSize:10}),h=v(),i=v([]),o=v(!0),$=v(0),S=()=>{ExportExcel(i,y)},c=v(""),b=v("");function u(){z(c.value)}const y=[{label:"序号",type:"index",minWidth:20},{label:"编号",prop:"id",hide:!0},{label:"路径",prop:"path",hide:!0},{label:"是否文件",prop:"isDir",hide:!0},{label:"后缀",prop:"extension",hide:!0},{label:"名称",prop:"name",sortable:!0,minWidth:120,cellRenderer:({row:t})=>{const e=()=>{A("打开",t)},n=g=>f("div",{style:"display: flex; align-items: center"},[f(O("el-icon"),null,ce(g)?g:{default:()=>[g]}),f("span",null,[k("    ")]),f(O("el-button"),{type:t.isDir?"danger":"primary",onClick:e,link:!0},{default:()=>[t.name]})]);return t.isDir?n(f(ee,null,null)):n(f(te,null,null))}},{label:"大小",sortable:!0,prop:"size",minWidth:80,cellRenderer:({row:t})=>f("div",null,[t.size,f("span",null,[k(" ")]),k("KB")])},{label:"修改时间",sortable:!0,minWidth:120,prop:"update_time",formatter:({update_time:t})=>X(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function W(t){T(t.id).then(e=>s(this,null,function*(){e.code===200?(l(`您删除了文件ID为${t.id}的这条数据`,{type:"success"}),yield x()):l(`操作失败，${e.message}`,{type:"error"})}))}const Y=J(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);function x(){return s(this,null,function*(){o.value=!0;const{data:t}=yield B(Z(a));i.value=t.items,b.value=t.path,c.value=t.path,setTimeout(()=>{o.value=!1},500)})}function I(t){return s(this,null,function*(){const e={route:t};o.value=!0;const{data:n}=yield B(e);i.value=n.items,c.value=n.path,setTimeout(()=>{o.value=!1},500)})}function z(t){return s(this,null,function*(){const e={route:t};o.value=!0;const{data:n}=yield se(e);i.value=n.items,c.value=n.path,setTimeout(()=>{o.value=!1},500)})}function A(t="打开",e){var n,g,M;if(t==="打开"){const R={route:e.path};e.isDir?I(e.path):le(R).then(r=>s(this,null,function*(){var _,p,D,F,d;r.code===200?(e.content=r.data,N({title:`${t}文件`,props:{formInline:{title:t,content:(_=e==null?void 0:e.content)!=null?_:"",extension:(p=e==null?void 0:e.extension)!=null?p:"",name:(D=e==null?void 0:e.name)!=null?D:"",parent_path:(F=e==null?void 0:e.parent_path)!=null?F:"",path:(d=e==null?void 0:e.path)!=null?d:""}},width:"46%",draggable:!0,fullscreen:!!q.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>V(j,{ref:h}),beforeSure:(E,{options:H})=>{const K=h.value.getRef(),C=H.props.formInline;function P(){l(`您编辑了文件为${C.name}的这条数据`,{type:"success"}),E(),I(e.parent_path)}K.validate(U=>{U&&ue(C).then(L=>s(this,null,function*(){L.code===200?yield P():l(`操作失败，${L.message}`,{type:"error"})}))})}})):l(`操作失败，${r.message}`,{type:"error"})}));return}else if(t==="删除"){const R={path:e.path};T(R).then(r=>s(this,null,function*(){r.code===200?(l(`您删除了文件名为${e.name}的这条数据`,{type:"success"}),yield x()):l(`操作失败，${r.message}`,{type:"error"})}));return}N({title:`${t}`,props:{formInline:{title:t,content:(n=e==null?void 0:e.content)!=null?n:"",name:(g=e==null?void 0:e.name)!=null?g:"",path:(M=e==null?void 0:e.path)!=null?M:""}},width:"46%",draggable:!0,fullscreen:!!q.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>V(j,{ref:h}),beforeSure:(R,{options:r})=>{const _=h.value.getRef(),p=r.props.formInline;function D(){l(`您${t}了文件为${p.name}的这条数据`,{type:"success"}),R(),x()}_.validate(F=>{F&&(t==="新增文件"?(p.path=c.value,ie(p).then(d=>s(this,null,function*(){d.code===200?yield D():l(`操作失败，${d.message}`,{type:"error"})}))):t==="新增文件夹"&&(p.path=c.value,oe(p).then(d=>s(this,null,function*(){d.code===200?yield D():l(`操作失败，${d.message}`,{type:"error"})}))))})}})}return Q(()=>s(this,null,function*(){x()})),{form:a,loading:o,columns:y,dataList:i,exportExcel:S,selectedNum:$,isMobile:q,onSearch:x,copyString:de,BackRoute:u,buttonClass:Y,openDialog:A,handleDelete:W}}export{ve as useRole};
