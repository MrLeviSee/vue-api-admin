var F=Object.defineProperty,H=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var D=(t,n,s)=>n in t?F(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,M=(t,n)=>{for(var s in n||(n={}))U.call(n,s)&&D(t,s,n[s]);if(z)for(var s of z(n))Y.call(n,s)&&D(t,s,n[s]);return t},$=(t,n)=>H(t,O(n));var y=(t,n,s)=>new Promise((p,f)=>{var i=l=>{try{b(s.next(l))}catch(g){f(g)}},m=l=>{try{b(s.throw(l))}catch(g){f(g)}},b=l=>l.done?p(l.value):Promise.resolve(l.value).then(i,m);b((s=s.apply(t,n)).next())});import{aN as x,t as L,n as I,x as j,b as C,a8 as A,aA as r,aL as E,r as k,at as N,aO as G,aM as J,af as K}from"./index-D3FY82Rz.js";import{u as Q,_ as X}from"./form.vue_vue_type_script_setup_true_lang-CDLdzruB.js";import{u as Z}from"./useBasicLayout-DS6NlR9d.js";import"./index-CsrB2J66.js";const w=t=>x.request("post","/api/blackip/list",{data:t}),ee=t=>x.request("post","/api/blackip/add",{data:t}),te=t=>{const n=`/api/blackip/del/${t}`;return x.request("delete",n)},ae=(t,n)=>x.request("put",`/api/blackip/update/${t}`,{data:n}),{clipboardValue:ne,copied:se}=G(),{isMobile:V}=Z(),le=t=>{ne.value=t,se.value&&r("复制成功",{type:"success"})};function de(){const t=L({ip:"",status:void 0,enable:void 0,currentPage:1,pageSize:10}),n=I(),s=I([]),p=I(!0),f=L({total:0,pageSize:10,currentPage:1,pageSizes:[10,20,50,100],background:!0}),i=I({}),{switchStyle:m}=Q(),l=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:e=>(t.currentPage-1)*t.pageSize+e+1,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"IP地址",prop:"ip",minWidth:130,cellRenderer:({row:e})=>C(k("el-button"),{type:"primary",onClick:()=>le(e.ip),link:!0},{default:()=>[e.ip]})},{label:"永封状态",prop:"enable",minWidth:90,cellRenderer:e=>{var a;return C(k("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=i.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":u=>e.row.enable=u,"active-value":!0,"inactive-value":!1,"active-text":"永久封禁","inactive-text":"暂未封禁","inline-prompt":!0,style:m.value,onChange:()=>P($(M({},e),{row:e.row,type:"enable"}))},null)}},{label:"临封状态",prop:"status",minWidth:90,cellRenderer:e=>{var a;return C(k("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=i.value[e.index])==null?void 0:a.loading,modelValue:e.row.status,"onUpdate:modelValue":u=>e.row.status=u,"active-value":!0,"inactive-value":!1,"active-text":"临时封禁","inactive-text":"暂未封禁","inline-prompt":!0,style:m.value,onChange:()=>P($(M({},e),{row:e.row,type:"status"}))},null)}},{label:"解封时间",minWidth:180,prop:"block_time",formatter:({block_time:e})=>e===0?"已解封":N(e*1e3).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function g(e){te(e.id).then(a=>y(this,null,function*(){a.code===200?(r(`您删除了IP编号为${e.id}的这条数据`,{type:"success"}),yield c()):r(`操作失败，${a.message}`,{type:"error"})}))}function P({row:e,index:a,type:u}){const o=u==="enable",v=o?`确认要<strong>${e.enable?"永久封禁":"解除永久封禁"}IP</strong><strong style='color:var(--el-color-primary)'>${e.ip}</strong>吗?`:`确认要<strong>${e.status?"临时封禁":"解除临时封禁"}IP</strong><strong style='color:var(--el-color-primary)'>${e.ip}</strong>吗?`;J.confirm(v,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[a]=Object.assign({},i.value[a],{loading:!0});const d={enable:void 0,status:void 0,block_time:void 0};o?d.enable=e.enable:(d.status=e.status,d.block_time=e.status?Math.floor(Date.now()/1e3)+12*60*60:0),ae(e.id,d).then(h=>{h.code===200?setTimeout(()=>{i.value[a]=Object.assign({},i.value[a],{loading:!1}),o||c(),r("已成功修改IP状态",{type:"success"})},200):r(`操作失败，${h.message}`,{type:"error"})})}).catch(()=>{o?e.enable=!e.enable:e.status=!e.status})}function _(e="新增",a){var u,o,v;E({title:`${e}IP地址`,props:{formInline:{title:e,ip:(u=a==null?void 0:a.ip)!=null?u:"",enable:(o=a==null?void 0:a.enable)!=null?o:!1,status:(v=a==null?void 0:a.status)!=null?v:!0}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!V.value,closeOnClickModal:!1,contentRenderer:()=>K(X,{ref:n,formInline:null}),beforeSure:(d,{options:h})=>{const W=n.value.getRef(),R=h.props.formInline;function q(){r(`您成功${e}了${R.ip}的数据`,{type:"success"}),d(),c()}W.validate(B=>{B&&e==="新增"&&ee(R).then(S=>y(this,null,function*(){S.code===200?yield q():r(`操作失败，${S.message}`,{type:"error"})}))})}})}function c(){return y(this,null,function*(){p.value=!0;const{data:e}=yield w(A(t));s.value=e.results,f.total=e.total,setTimeout(()=>{p.value=!1},500)})}const T=e=>{e&&(e.resetFields(),c())};return j(()=>{c()}),{form:t,loading:p,columns:l,dataList:s,pagination:f,isMobile:V,openDialog:_,onSearch:c,resetForm:T,handleDelete:g}}export{de as useRole};
